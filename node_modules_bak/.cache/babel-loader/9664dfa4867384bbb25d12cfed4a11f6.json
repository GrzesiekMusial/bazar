{"ast":null,"code":"import { flip } from \"lodash\";\nimport { toast } from \"react-toastify\";\nimport * as noticeBase from \"../services/notices\";\nimport * as productBase from \"../services/products\";\nimport { cubby } from \"./cubby\";\n\nconst noticeSave = async (item, edit, image) => {\n  return await save(item, edit, image, noticeBase, cubby.notices);\n};\n\nconst productSave = async (item, edit, image) => {\n  item.price = await checkPrice(item.price);\n  return await save(item, edit, image, productBase, cubby.products);\n};\n\nconst save = async (item, edit, image, base, cubby) => {\n  item.images = await checkImage(image);\n  const form = new FormData();\n  if (item.images.new.length > 0) for (const img of item.images.new) {\n    form.append(\"file\", img);\n  }\n  form.append(\"title\", item.title);\n  form.append(\"text\", item.text);\n  form.append(\"price\", item.price);\n  form.append(\"category\", item.category);\n  let response;\n\n  if (edit) {\n    if (item.images.old.length > 0) for (const img of item.images.old) {\n      form.append(\"images\", img);\n    }\n    form.append(\"_id\", edit._id);\n    response = await base.edit(edit._id, form);\n  } else {\n    response = await base.add(form);\n  }\n\n  if (!response.ok) throw toast.error(\"Can't save! please check internet connection\", {\n    position: \"top-right\",\n    autoClose: 2500,\n    hideProgressBar: true,\n    closeOnClick: true,\n    pauseOnHover: false,\n    draggable: true,\n    progress: undefined,\n    transition: {\n      flip\n    }\n  });\n\n  if (cubby.data) {\n    if (edit) {\n      cubby.data = cubby.data.filter(item => item._id !== edit._id);\n    }\n\n    const newCube = response.data.item;\n\n    if (response.data.item.category) {\n      const id = newCube.category;\n      newCube.category = {};\n      newCube.category._id = id;\n    }\n\n    newCube.author = response.data.author;\n    cubby.data.unshift(newCube);\n  }\n\n  toast.success(\"saved\", {\n    position: \"top-right\",\n    autoClose: 2500,\n    hideProgressBar: true,\n    closeOnClick: true,\n    pauseOnHover: false,\n    draggable: true,\n    progress: undefined\n  });\n  return response.data.item;\n};\n\nconst checkImage = async images => {\n  const result = {\n    old: [],\n    new: []\n  };\n\n  for await (const img of images) {\n    typeof img === \"string\" ? result.old.push(img) : result.new.push(img);\n  }\n\n  return result;\n};\n\nconst checkPrice = async price => {\n  try {\n    if (price) {\n      price = price.trim();\n      price = +parseFloat(price).toFixed(2);\n    } else {\n      price = 0;\n    }\n  } catch (e) {}\n\n  price = price.toString();\n  return price;\n};\n\nexport { noticeSave, productSave };","map":{"version":3,"sources":["C:/dev/TESTY/TEST NATIVE/bazar/src/methods/save.js"],"names":["flip","toast","noticeBase","productBase","cubby","noticeSave","item","edit","image","save","notices","productSave","price","checkPrice","products","base","images","checkImage","form","FormData","new","length","img","append","title","text","category","response","old","_id","add","ok","error","position","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","transition","data","filter","newCube","id","author","unshift","success","result","push","trim","parseFloat","toFixed","e","toString"],"mappings":"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","sourcesContent":["import { flip } from \"lodash\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nimport * as noticeBase from \"../services/notices\";\r\nimport * as productBase from \"../services/products\";\r\nimport { cubby } from \"./cubby\";\r\n\r\nconst noticeSave = async (item, edit, image) => {\r\n    return await save(item, edit, image, noticeBase, cubby.notices);\r\n};\r\n\r\nconst productSave = async (item, edit, image) => {\r\n    item.price = await checkPrice(item.price);\r\n    return await save(item, edit, image, productBase, cubby.products);\r\n};\r\n\r\nconst save = async (item, edit, image, base, cubby) => {\r\n    item.images = await checkImage(image);\r\n\r\n    const form = new FormData();\r\n\r\n    if (item.images.new.length > 0)\r\n        for (const img of item.images.new) {\r\n            form.append(\"file\", img);\r\n        }\r\n    form.append(\"title\", item.title);\r\n    form.append(\"text\", item.text);\r\n    form.append(\"price\", item.price);\r\n    form.append(\"category\", item.category);\r\n\r\n    let response;\r\n    if (edit) {\r\n        if (item.images.old.length > 0)\r\n            for (const img of item.images.old) {\r\n                form.append(\"images\", img);\r\n            }\r\n\r\n        form.append(\"_id\", edit._id);\r\n\r\n        response = await base.edit(edit._id, form);\r\n    } else {\r\n        response = await base.add(form);\r\n    }\r\n    if (!response.ok)\r\n        throw toast.error(\"Can't save! please check internet connection\", {\r\n            position: \"top-right\",\r\n            autoClose: 2500,\r\n            hideProgressBar: true,\r\n            closeOnClick: true,\r\n            pauseOnHover: false,\r\n            draggable: true,\r\n            progress: undefined,\r\n            transition: { flip },\r\n        });\r\n    if (cubby.data) {\r\n        if (edit) {\r\n            cubby.data = cubby.data.filter((item) => item._id !== edit._id);\r\n        }\r\n\r\n        const newCube = response.data.item;\r\n\r\n        if (response.data.item.category) {\r\n            const id = newCube.category;\r\n            newCube.category = {};\r\n            newCube.category._id = id;\r\n        }\r\n        newCube.author = response.data.author;\r\n        cubby.data.unshift(newCube);\r\n    }\r\n    toast.success(\"saved\", {\r\n        position: \"top-right\",\r\n        autoClose: 2500,\r\n        hideProgressBar: true,\r\n        closeOnClick: true,\r\n        pauseOnHover: false,\r\n        draggable: true,\r\n        progress: undefined,\r\n    });\r\n    return response.data.item;\r\n};\r\n\r\nconst checkImage = async (images) => {\r\n    const result = { old: [], new: [] };\r\n\r\n    for await (const img of images) {\r\n        typeof img === \"string\" ? result.old.push(img) : result.new.push(img);\r\n    }\r\n\r\n    return result;\r\n};\r\n\r\nconst checkPrice = async (price) => {\r\n    try {\r\n        if (price) {\r\n            price = price.trim();\r\n            price = +parseFloat(price).toFixed(2);\r\n        } else {\r\n            price = 0;\r\n        }\r\n    } catch (e) {}\r\n    price = price.toString();\r\n    return price;\r\n};\r\n\r\nexport { noticeSave, productSave };\r\n"]},"metadata":{},"sourceType":"module"}